<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe Finder</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Recipe Finder</h1>

  <div class="input-container">
    <input type="text" id="searchInput" placeholder="Enter a recipe name">
    <button onclick="searchRecipe()">Search</button>
  </div>

  <div id="recipeContainer"></div>
  <div id="recipeButtons"></div>

  <script>
    // Event listener to trigger searchRecipe() on Enter key press
    document.getElementById('searchInput').addEventListener('keydown', function(event) {
      console.log('Key pressed:', event.key); // Debugging line
      if (event.key === 'Enter') {
        searchRecipe();
      }
    });

    function searchRecipe() {
      const searchQuery = document.getElementById('searchInput').value.trim();
      if (searchQuery === '') {
        alert('Please enter a recipe name');
        return;
      }

      fetch(`https://www.themealdb.com/api/json/v1/1/search.php?s=${searchQuery}`)
        .then(response => response.json())
        .then(data => {
          const recipeContainer = document.getElementById('recipeContainer');
          const recipeButtons = document.getElementById('recipeButtons');
          recipeContainer.innerHTML = '';
          recipeButtons.innerHTML = '';

          if (data.meals && data.meals.length !== 1) {
            data.meals.forEach(meal => {
              displayRecipeButton(meal);
            });
          } else if (data.meals) {
            displayRecipe(data.meals[0]);
          } else {
            recipeContainer.innerHTML = '<p id="erm">We do not have this recipe yet üòê</p>';
            fetch('https://www.themealdb.com/api/json/v1/1/random.php')
              .then(response => response.json())
              .then(data => {
                recipeButtons.innerHTML = '<h5 id="error_text">Wanna try this: </h5>';
                displayRecipeButton(data.meals[0]);
              });
          }
        })
        .catch(error => {
          console.error('Error fetching data:', error);
          const recipeContainer = document.getElementById('recipeContainer');
          recipeContainer.innerHTML = '<p id="erm">Failed to fetch recipe. Please try again later.</p>';
        });
    }

    function getRandomRecipe() {
      const recipeContainer = document.getElementById('recipeContainer');
      const recipeButtons = document.getElementById('recipeButtons');
      recipeContainer.innerHTML = '';
      recipeButtons.innerHTML = '';
      fetch('https://www.themealdb.com/api/json/v1/1/random.php')
        .then(response => response.json())
        .then(data => {
          displayRecipe(data.meals[0]);
        })
        .catch(error => {
          console.error('Error fetching data:', error);
          alert('Failed to fetch random recipe. Please try again later.');
        });
    }

    function displayRecipe(recipe) {
      const recipeContainer = document.getElementById('recipeContainer');
      try {
        document.getElementById("erm").remove();
      } catch {}

      if (!recipe) {
        recipeContainer.innerHTML = '<p>No recipe found.</p>';
        return;
      }

      recipeContainer.innerHTML = ''; // Clear previous content

      const recipeTitle = document.createElement('h2');
      recipeTitle.textContent = recipe.strMeal;
      recipeContainer.appendChild(recipeTitle);

      const recipeImage = document.createElement('img');
      recipeImage.src = `${recipe.strMealThumb}/preview`;
      recipeImage.alt = recipe.strMeal;
      recipeContainer.appendChild(recipeImage);

      const ingredientsList = document.createElement('ul');
      for (let i = 1; i <= 20; i++) {
        const ingredient = recipe[`strIngredient${i}`];
        const measure = recipe[`strMeasure${i}`];
        if (ingredient) {
          const listItem = document.createElement('li');
          listItem.textContent = `${ingredient} - ${measure}`;
          ingredientsList.appendChild(listItem);
        }
      }
      const recipeInstructions = document.createElement('p');
      var txt = "<h3>Instructions: </h3>";
      var link = `<p><a href=${recipe.strYoutube}><button id='inst'>Click here for video tutorial</button></a></p>`;
      recipeInstructions.innerHTML = txt + recipe.strInstructions + link;
      recipeContainer.appendChild(ingredientsList);
      recipeContainer.appendChild(recipeInstructions);
    }

    function displayRecipeButton(recipe) {
      const recipeButtons = document.getElementById("recipeButtons");
      const recipeButton = document.createElement('button');
      recipeButton.textContent = recipe.strMeal;
      recipeButton.addEventListener('click', function() {
        displayRecipe(recipe);
        recipeButton.remove();
        const errorText = document.getElementById('error_text');
        if (errorText) {
          errorText.remove();
        }
      });
      recipeButtons.appendChild(recipeButton);
    }
  </script>
</body>
</html>
